<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•ó Nutrifit AI - Il Tuo Nutrizionista Digitale</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #00C851;
            --secondary-green: #4CAF50;
            --light-green: #81C784;
            --accent-orange: #FF6B35;
            --warm-orange: #FF8A50;
            --soft-beige: #F8F6F0;
            --cream: #FFF9E6;
            --earth-brown: #8D6E63;
            --sage-green: #7CB342;
            --mint: #26A69A;
            --natural-white: #FFFFFF;
            --text-dark: #1A1A1A;
            --text-medium: #4A4A4A;
            --text-light: #757575;
            --shadow-soft: rgba(0, 200, 81, 0.25);
            --shadow-warm: rgba(255, 107, 53, 0.3);
            --gradient-primary: linear-gradient(135deg, #00C851 0%, #4CAF50 50%, #26A69A 100%);
            --gradient-secondary: linear-gradient(135deg, #FF6B35 0%, #FF8A50 100%);
            --gradient-bg: linear-gradient(135deg, #FFF9E6 0%, #F8F6F0 25%, #E8F5E8 50%, #F0F8FF 75%, #FFF9E6 100%);
        }

        body {
            font-family: 'Inter', 'Poppins', sans-serif;
            background: var(--gradient-bg);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: var(--text-dark);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Language Selection Modal */
        .language-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(20px);
            animation: modalFadeIn 0.8s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; backdrop-filter: blur(0px); }
            to { opacity: 1; backdrop-filter: blur(20px); }
        }

        .language-modal.hidden {
            display: none;
        }

        .language-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 246, 240, 0.9));
            border-radius: 30px;
            padding: 50px;
            text-align: center;
            box-shadow: 
                0 30px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 2px solid transparent;
            background-clip: padding-box;
            max-width: 450px;
            width: 90%;
            position: relative;
            overflow: hidden;
            animation: cardFloat 3s ease-in-out infinite;
        }

        @keyframes cardFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-10px) scale(1.02); }
        }

        .language-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-primary);
            border-radius: 32px;
            z-index: -1;
            animation: borderGlow 3s ease-in-out infinite;
        }

        @keyframes borderGlow {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .language-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            animation: titlePulse 2s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .language-card p {
            color: var(--text-medium);
            margin-bottom: 40px;
            font-size: 1.2rem;
            font-weight: 400;
            line-height: 1.6;
        }

        .language-buttons {
            display: flex;
            gap: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .language-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 18px 35px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 8px 25px rgba(0, 200, 81, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            min-width: 140px;
            position: relative;
            overflow: hidden;
        }

        .language-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s;
        }

        .language-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 
                0 15px 35px rgba(0, 200, 81, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        .language-btn:hover::before {
            left: 100%;
        }

        .language-btn.secondary {
            background: var(--gradient-secondary);
            box-shadow: 
                0 8px 25px rgba(255, 107, 53, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .language-btn.secondary:hover {
            box-shadow: 
                0 15px 35px rgba(255, 107, 53, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        /* Advanced Background Effects */
        .cosmic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 200, 81, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(38, 166, 154, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 60% 70%, rgba(124, 179, 66, 0.15) 0%, transparent 50%);
            animation: cosmicFloat 20s ease-in-out infinite;
        }

        @keyframes cosmicFloat {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                filter: hue-rotate(0deg);
            }
            25% { 
                transform: scale(1.1) rotate(90deg);
                filter: hue-rotate(90deg);
            }
            50% { 
                transform: scale(1.2) rotate(180deg);
                filter: hue-rotate(180deg);
            }
            75% { 
                transform: scale(1.1) rotate(270deg);
                filter: hue-rotate(270deg);
            }
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--primary-green);
            border-radius: 50%;
            animation: particleFloat 12s infinite linear;
            opacity: 0.7;
            box-shadow: 0 0 10px currentColor;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) translateX(0px) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
                transform: scale(1);
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100px) translateX(100px) scale(0);
                opacity: 0;
            }
        }

        /* Enhanced Floating Leaves */
        .leaves {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .leaf {
            position: absolute;
            width: 25px;
            height: 25px;
            background: var(--primary-green);
            border-radius: 0 100% 0 100%;
            animation: leafFall 18s infinite linear;
            opacity: 0.8;
            box-shadow: 0 0 15px rgba(0, 200, 81, 0.3);
        }

        @keyframes leafFall {
            0% {
                transform: translateY(-100px) rotate(0deg) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
                transform: scale(1);
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(360deg) scale(0);
                opacity: 0;
            }
        }

        /* Main Container */
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            border-radius: 0;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(255, 255, 255, 0.7) 25%,
                transparent 50%, 
                rgba(0, 200, 81, 0.05) 75%,
                rgba(255, 255, 255, 0.8) 100%);
            pointer-events: none;
            animation: containerGlow 10s ease-in-out infinite;
        }

        @keyframes containerGlow {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* Spectacular Header */
        .header {
            background: var(--gradient-primary);
            padding: 40px;
            text-align: center;
            border-bottom: 4px solid var(--accent-orange);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            animation: headerShimmer 3s infinite;
        }

        @keyframes headerShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.15) 0%, transparent 50%);
            animation: headerParticles 8s ease-in-out infinite;
        }

        @keyframes headerParticles {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3.8rem;
            font-weight: 700;
            color: white;
            margin-bottom: 15px;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 255, 255, 0.5);
            position: relative;
            z-index: 2;
            animation: titleGlow 4s ease-in-out infinite;
            letter-spacing: -1px;
            background: linear-gradient(45deg, #ffffff, #e8f5e8, #ffffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @keyframes titleGlow {
            0%, 100% { 
                text-shadow: 
                    2px 2px 4px rgba(0, 0, 0, 0.3),
                    0 0 20px rgba(255, 255, 255, 0.5);
            }
            50% { 
                text-shadow: 
                    2px 2px 4px rgba(0, 0, 0, 0.3),
                    0 0 30px rgba(255, 255, 255, 0.8),
                    0 0 40px rgba(0, 200, 81, 0.3);
            }
        }

        .header .logo-img {
            display: inline-block;
            height: 60px;
            width: auto;
            margin-right: 20px;
            animation: logoFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
            vertical-align: middle;
        }

        @keyframes logoFloat {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg) scale(1);
            }
            50% { 
                transform: translateY(-15px) rotate(5deg) scale(1.1);
            }
        }

        .header p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.4rem;
            font-weight: 400;
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            animation: subtitleFade 3s ease-in-out infinite;
        }

        @keyframes subtitleFade {
            0%, 100% { opacity: 0.95; }
            50% { opacity: 1; }
        }

        .language-indicator {
            position: absolute;
            top: 20px;
            right: 25px;
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 3;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .language-indicator:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            scroll-behavior: smooth;
            position: relative;
        }

        .chat-messages::-webkit-scrollbar {
            width: 12px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: linear-gradient(45deg, var(--light-green), var(--mint));
            border-radius: 6px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 6px;
            box-shadow: 0 0 15px var(--shadow-soft);
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, var(--primary-green), var(--secondary-green));
        }

        /* Enhanced Messages */
        .message {
            margin-bottom: 30px;
            animation: messageSlideIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.8) rotateX(90deg);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1) rotateX(0deg);
            }
        }

        .message.user {
            text-align: right;
        }

        .message.ai {
            text-align: left;
        }

        .message-bubble {
            display: inline-block;
            max-width: 75%;
            padding: 25px 30px;
            border-radius: 30px;
            word-wrap: break-word;
            position: relative;
            backdrop-filter: blur(15px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1.7;
            font-weight: 400;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .message-bubble:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .message.user .message-bubble {
            background: var(--gradient-secondary);
            color: white;
            border-bottom-right-radius: 10px;
            box-shadow: 
                0 12px 30px var(--shadow-warm),
                0 0 0 1px rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .message.user .message-bubble::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .message.user .message-bubble:hover::before {
            left: 100%;
        }

        .message.ai .message-bubble {
            background: linear-gradient(145deg, var(--natural-white), rgba(248, 246, 240, 0.9));
            color: var(--text-dark);
            border: 2px solid transparent;
            border-bottom-left-radius: 10px;
            box-shadow: 
                0 12px 30px var(--shadow-soft),
                0 0 0 1px rgba(0, 200, 81, 0.2);
            position: relative;
            background-clip: padding-box;
        }

        .message.ai .message-bubble::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-primary);
            border-radius: 32px;
            z-index: -1;
            opacity: 0.8;
        }

        .message.ai .message-bubble::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                rgba(0, 200, 81, 0.1), 
                transparent, 
                rgba(38, 166, 154, 0.05));
            border-radius: 28px;
            animation: aiGlow 5s ease-in-out infinite;
        }

        @keyframes aiGlow {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.02); }
        }

        .message-time {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 10px;
            opacity: 0.8;
            font-weight: 500;
        }

        /* Spectacular Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 25px 40px;
            margin-bottom: 25px;
            animation: messageSlideIn 0.6s ease-out;
            text-align: left;
        }

        .typing-indicator.show {
            display: block;
        }

        .typing-dots {
            display: inline-block;
            background: linear-gradient(145deg, var(--natural-white), rgba(248, 246, 240, 0.95));
            border: 2px solid transparent;
            border-radius: 30px;
            padding: 22px 30px;
            border-bottom-left-radius: 10px;
            box-shadow: 
                0 12px 30px var(--shadow-soft),
                0 0 0 1px rgba(0, 200, 81, 0.2);
            position: relative;
            margin-top: 40px;
            backdrop-filter: blur(15px);
            background-clip: padding-box;
        }

        .typing-dots::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-primary);
            border-radius: 32px;
            z-index: -1;
            opacity: 0.8;
            animation: typingBorder 2s ease-in-out infinite;
        }

        @keyframes typingBorder {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .typing-text {
            position: relative;
            top: 0;
            left: 0;
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-green);
            padding: 8px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--primary-green);
            box-shadow: 0 4px 15px rgba(0, 200, 81, 0.2);
            white-space: nowrap;
            animation: typingTextPulse 2s ease-in-out infinite;
            margin-bottom: 10px;
            display: inline-block;
        }

        @keyframes typingTextPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .typing-dots span {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--primary-green);
            margin: 0 4px;
            animation: typingBounce 1.6s infinite ease-in-out;
            box-shadow: 
                0 0 15px var(--shadow-soft),
                0 0 5px currentColor;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        .typing-dots span:nth-child(3) { animation-delay: 0s; }

        @keyframes typingBounce {
            0%, 80%, 100% {
                transform: scale(0.8) translateY(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1.3) translateY(-15px);
                opacity: 1;
                box-shadow: 
                    0 0 20px var(--shadow-soft),
                    0 0 10px currentColor;
            }
        }

        /* Enhanced Welcome Message */
        .welcome-message {
            text-align: center;
            padding: 60px 40px;
            color: var(--text-medium);
            position: relative;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.8), rgba(248, 246, 240, 0.6));
            border-radius: 25px;
            margin: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .welcome-message h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 25px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: welcomeGlow 3s ease-in-out infinite;
        }

        @keyframes welcomeGlow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .welcome-message p {
            font-size: 1.2rem;
            line-height: 1.8;
            max-width: 700px;
            margin: 0 auto 30px;
            font-weight: 400;
        }

        .nutrition-icons {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .nutrition-icon {
            font-size: 2.5rem;
            animation: iconFloat 4s ease-in-out infinite;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nutrition-icon:hover {
            transform: scale(1.2) rotate(10deg);
            filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.2));
        }

        .nutrition-icon:nth-child(1) { animation-delay: 0s; }
        .nutrition-icon:nth-child(2) { animation-delay: 0.5s; }
        .nutrition-icon:nth-child(3) { animation-delay: 1s; }
        .nutrition-icon:nth-child(4) { animation-delay: 1.5s; }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-12px) rotate(5deg); }
        }

        /* Spectacular Input Container */
        .input-container {
            padding: 30px 40px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 246, 240, 0.9));
            border-top: 4px solid transparent;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .input-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            background-size: 200% 100%;
            animation: borderFlow 3s linear infinite;
        }

        @keyframes borderFlow {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .input-form {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            position: relative;
            z-index: 1;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        #messageInput {
            width: 100%;
            padding: 22px 30px;
            border: 2px solid transparent;
            border-radius: 35px;
            background: linear-gradient(white, white) padding-box,
                        var(--gradient-primary) border-box;
            color: var(--text-dark);
            font-size: 1.1rem;
            resize: none;
            min-height: 60px;
            max-height: 160px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        #messageInput:focus {
            background: linear-gradient(var(--cream), var(--cream)) padding-box,
                        var(--gradient-primary) border-box;
            box-shadow: 
                0 0 0 4px rgba(0, 200, 81, 0.2),
                0 12px 35px rgba(0, 200, 81, 0.15);
            transform: translateY(-3px) scale(1.02);
        }

        #messageInput::placeholder {
            color: var(--text-light);
            font-style: italic;
            font-weight: 400;
        }

        #sendButton {
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 65px;
            height: 65px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 12px 30px var(--shadow-soft),
                0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        #sendButton::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translate(-50%, -50%);
        }

        #sendButton:hover {
            transform: scale(1.15) rotate(15deg);
            box-shadow: 
                0 20px 40px var(--shadow-soft),
                0 0 0 1px rgba(255, 255, 255, 0.3);
        }

        #sendButton:hover::before {
            width: 100%;
            height: 100%;
        }

        #sendButton:active {
            transform: scale(0.95);
        }

        #sendButton:disabled {
            background: linear-gradient(45deg, var(--light-green), var(--mint));
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced Floating Action Buttons */
        .floating-actions {
            position: fixed;
            bottom: 120px;
            right: 40px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 1000;
        }

        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: var(--gradient-secondary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 12px 30px var(--shadow-warm),
                0 0 0 1px rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .floating-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        .floating-btn:hover {
            transform: scale(1.15) rotate(10deg);
            box-shadow: 
                0 20px 40px var(--shadow-warm),
                0 0 0 1px rgba(255, 255, 255, 0.3);
        }

        .floating-btn:hover::before {
            left: 100%;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border: none;
                border-radius: 0;
                max-width: 100%;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2.8rem;
            }

            .header .logo {
                font-size: 3rem;
            }

            .message-bubble {
                max-width: 85%;
                padding: 20px 25px;
            }

            .input-container {
                padding: 25px 20px;
            }

            #messageInput {
                font-size: 16px;
                padding: 18px 25px;
            }

            .floating-actions {
                bottom: 140px;
                right: 25px;
            }

            .floating-btn {
                width: 55px;
                height: 55px;
                font-size: 1.2rem;
            }

            .nutrition-icons {
                gap: 20px;
            }

            .nutrition-icon {
                font-size: 2rem;
            }

            .language-card {
                padding: 40px 25px;
                margin: 0 20px;
            }

            .language-card h2 {
                font-size: 2rem;
            }

            .language-buttons {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .language-btn {
                width: 100%;
                max-width: 220px;
            }

            .welcome-message {
                padding: 40px 25px;
                margin: 15px;
            }

            .welcome-message h2 {
                font-size: 2.2rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 25px 15px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .header .logo {
                font-size: 2.5rem;
            }

            .chat-messages {
                padding: 25px 15px;
            }

            .message-bubble {
                max-width: 90%;
                padding: 15px 20px;
            }

            .welcome-message {
                padding: 30px 20px;
                margin: 10px;
            }

            .welcome-message h2 {
                font-size: 1.8rem;
            }

            .input-container {
                padding: 20px 15px;
            }

            #messageInput {
                padding: 15px 20px;
            }

            #sendButton {
                width: 55px;
                height: 55px;
                font-size: 1.3rem;
            }
        }

        /* Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-bg);
            background-size: 400% 400%;
            animation: gradientShift 3s ease infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.8s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(0, 200, 81, 0.2);
            border-left: 6px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 30px rgba(0, 200, 81, 0.3);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Additional spectacular effects */
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            animation: sparkle 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes sparkle {
            0%, 100% { 
                opacity: 0; 
                transform: scale(0); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1); 
                box-shadow: 0 0 10px white;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selection Modal -->
    <div class="language-modal" id="languageModal">
        <div class="language-card">
            <h2>üåç Scegli la lingua / Choose language</h2>
            <p>Seleziona la tua lingua preferita per iniziare<br>Select your preferred language to start</p>
            <div class="language-buttons">
                <button class="language-btn" onclick="selectLanguage('it')">
                    üáÆüáπ Italiano
                </button>
                <button class="language-btn secondary" onclick="selectLanguage('en')">
                    üá¨üáß English
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Advanced Background Effects -->
    <div class="cosmic-bg"></div>
    
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>
    
    <!-- Enhanced Floating Leaves -->
    <div class="leaves" id="leaves"></div>

    <div class="container">
        <div class="header">
            <div class="language-indicator" id="languageIndicator" onclick="showLanguageModal()">
                üáÆüáπ IT
            </div>
            <h1>Nutrifit AI</h1>
            <p id="headerSubtitle">Il tuo nutrizionista digitale personalizzato</p>
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="welcome-message">
                    <h2 id="welcomeTitle">üå± Benvenuto in Nutrifit AI!</h2>
                    <p id="welcomeText">Sono la tua intelligenza artificiale specializzata in nutrizione e benessere! Posso aiutarti con consigli alimentari personalizzati, piani nutrizionali, ricette salutari e tutto ci√≤ che riguarda il tuo benessere. Inizia chiedendomi qualsiasi cosa sulla nutrizione!</p>
                    <div class="nutrition-icons">
                        <span class="nutrition-icon">üçé</span>
                        <span class="nutrition-icon">ü•ï</span>
                        <span class="nutrition-icon">ü•ë</span>
                        <span class="nutrition-icon">üåø</span>
                    </div>
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-text" id="typingText">Sto pensando...</div>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            
            <div class="input-container">
                <form class="input-form" id="chatForm">
                    <div class="input-wrapper">
                        <textarea 
                            id="messageInput" 
                            placeholder="Chiedi a Nutrifit AI consigli su alimentazione e benessere..." 
                            rows="1"
                            maxlength="2000"
                        ></textarea>
                    </div>
                    <button type="submit" id="sendButton">
                        üå±
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Enhanced Floating Action Buttons -->
    <div class="floating-actions">
        <button class="floating-btn" onclick="clearChat()" title="Pulisci Chat">
            üóëÔ∏è
        </button>
        <button class="floating-btn" onclick="toggleTheme()" title="Modalit√† Scura">
            üåô
        </button>
    </div>

    <script>
        // IMPORTANTE: Chiave API configurata
        const OPENROUTER_API_KEY = "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";

        // Configurazione API
        const API_ENDPOINT = "https://openrouter.ai/api/v1/chat/completions";
        const MODEL_NAME = "deepseek/deepseek-r1-0528-qwen3-8b:free";

        // Elementi DOM
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatForm = document.getElementById('chatForm');
        const typingIndicator = document.getElementById('typingIndicator');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const leaves = document.getElementById('leaves');
        const particles = document.getElementById('particles');
        const languageModal = document.getElementById('languageModal');
        const languageIndicator = document.getElementById('languageIndicator');

        // Variabili globali
        let conversationHistory = [];
        let currentLanguage = 'it';

        // Testi multilingua
        const texts = {
            it: {
                headerSubtitle: "Il tuo nutrizionista digitale personalizzato",
                welcomeTitle: "üå± Benvenuto in Nutrifit AI!",
                welcomeText: "Sono la tua intelligenza artificiale specializzata in nutrizione e benessere! Posso aiutarti con consigli alimentari personalizzati, piani nutrizionali, ricette salutari e tutto ci√≤ che riguarda il tuo benessere. Inizia chiedendomi qualsiasi cosa sulla nutrizione!",
                inputPlaceholder: "Chiedi a Nutrifit AI consigli su alimentazione e benessere...",
                typingText: "Sto pensando...",
                systemPrompt: "Sei Nutrifit AI, un nutrizionista digitale esperto e amichevole. Fornisci consigli nutrizionali accurati, piani alimentari personalizzati e informazioni sul benessere. Rispondi sempre in italiano con un tono professionale ma caloroso. Evita di usare formattazione Markdown come #, **, *, -, ecc. Scrivi in testo semplice e pulito. Usa emoji appropriati per il tema alimentazione e salute.",
                clearConfirm: "üóëÔ∏è Vuoi davvero cancellare tutta la conversazione?",
                clearWelcome: "üå± Chat pulita!",
                clearText: "Inizia una nuova conversazione con Nutrifit AI!",
                errors: {
                    general: "üåø Mi dispiace, si √® verificato un errore. Riprova tra un momento!",
                    auth: "üîë Errore di autenticazione: Verifica la configurazione API.",
                    rate: "‚è∞ Troppi messaggi! Aspetta qualche secondo e riprova.",
                    server: "üîß Errore del server: Riprova pi√π tardi."
                }
            },
            en: {
                headerSubtitle: "Your personalized digital nutritionist",
                welcomeTitle: "üå± Welcome to Nutrifit AI!",
                welcomeText: "I'm your artificial intelligence specialized in nutrition and wellness! I can help you with personalized dietary advice, nutritional plans, healthy recipes and everything related to your wellbeing. Start by asking me anything about nutrition!",
                inputPlaceholder: "Ask Nutrifit AI for nutrition and wellness advice...",
                typingText: "Thinking...",
                systemPrompt: "You are Nutrifit AI, an expert and friendly digital nutritionist. Provide accurate nutritional advice, personalized meal plans and wellness information. Always respond in English with a professional but warm tone. Avoid using Markdown formatting like #, **, *, -, etc. Write in simple and clean text. Use appropriate emojis for food and health themes.",
                clearConfirm: "üóëÔ∏è Do you really want to delete the entire conversation?",
                clearWelcome: "üå± Chat cleared!",
                clearText: "Start a new conversation with Nutrifit AI!",
                errors: {
                    general: "üåø Sorry, an error occurred. Please try again in a moment!",
                    auth: "üîë Authentication error: Check API configuration.",
                    rate: "‚è∞ Too many messages! Wait a few seconds and try again.",
                    server: "üîß Server error: Try again later."
                }
            }
        };

        // Funzione per pulire il testo dalle formattazioni Markdown
        function cleanMarkdownText(text) {
            if (!text) return '';
            
            return text
                .replace(/^#{1,6}\s+/gm, '')
                .replace(/\*\*(.*?)\*\*/g, '$1')
                .replace(/__(.*?)__/g, '$1')
                .replace(/\*(.*?)\*/g, '$1')
                .replace(/_(.*?)_/g, '$1')
                .replace(/```[\s\S]*?```/g, '')
                .replace(/`([^`]+)`/g, '$1')
                .replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1')
                .replace(/^[\s]*[-\*\+]\s+/gm, '')
                .replace(/^[\s]*\d+\.\s+/gm, '')
                .replace(/^>\s+/gm, '')
                .replace(/[~`]/g, '')
                .replace(/\s+/g, ' ')
                .trim();
        }

        // Funzione per aggiornare i testi dell'interfaccia
        function updateInterfaceTexts() {
            const t = texts[currentLanguage];
            
            document.getElementById('headerSubtitle').textContent = t.headerSubtitle;
            document.getElementById('welcomeTitle').textContent = t.welcomeTitle;
            document.getElementById('welcomeText').textContent = t.welcomeText;
            document.getElementById('messageInput').placeholder = t.inputPlaceholder;
            document.getElementById('typingText').textContent = t.typingText;
            
            // Aggiorna indicatore lingua
            languageIndicator.textContent = currentLanguage === 'it' ? 'üáÆüáπ IT' : 'üá¨üáß EN';
        }

        // Funzione per selezionare la lingua
        function selectLanguage(lang) {
            currentLanguage = lang;
            languageModal.classList.add('hidden');
            updateInterfaceTexts();
            
            // Salva la preferenza
            localStorage.setItem('nutrifit_language', lang);
            
            // Inizializza l'app
            setTimeout(() => {
                initializeApp();
            }, 500);
        }

        // Funzione per mostrare il modal di selezione lingua
        function showLanguageModal() {
            languageModal.classList.remove('hidden');
        }

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            // Controlla se c'√® una lingua salvata
            const savedLanguage = localStorage.getItem('nutrifit_language');
            if (savedLanguage) {
                currentLanguage = savedLanguage;
                languageModal.classList.add('hidden');
                updateInterfaceTexts();
                initializeApp();
            } else {
                // Mostra il modal di selezione lingua
                loadingOverlay.classList.add('hidden');
            }
        });

        function initializeApp() {
            // Controlla e ripristina il tema salvato
            const savedTheme = localStorage.getItem('nutrifit_dark_theme');
            if (savedTheme === 'true') {
                isDarkTheme = false; // Impostiamo false cos√¨ toggleTheme() lo attiver√†
                toggleTheme();
            }

            // Nascondi loading dopo 2 secondi
            setTimeout(() => {
                loadingOverlay.classList.add('hidden');
            }, 2000);

            // Inizializza effetti spettacolari
            createParticles();
            createLeaves();
            createSparkles();
            
            // Focus su input
            messageInput.focus();
            adjustTextareaHeight();

            // Aggiungi effetti sonori (simulati con vibrazioni su mobile)
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            }
        }

        // Sistema di particelle fluttuanti
        function createParticles() {
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                setTimeout(() => {
                    createParticle();
                }, i * 100);
            }

            setInterval(createParticle, 600);
        }

        function createParticle() {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDuration = (Math.random() * 8 + 8) + 's';
            particle.style.animationDelay = Math.random() * 2 + 's';
            
            const colors = ['#00C851', '#4CAF50', '#26A69A', '#7CB342', '#FF6B35'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            particle.style.background = randomColor;
            particle.style.color = randomColor;
            
            particles.appendChild(particle);

            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 12000);
        }

        // Sistema di foglie fluttuanti migliorato
        function createLeaves() {
            const leafCount = 40;
            
            for (let i = 0; i < leafCount; i++) {
                setTimeout(() => {
                    createLeaf();
                }, i * 150);
            }

            setInterval(createLeaf, 500);
        }

        function createLeaf() {
            const leaf = document.createElement('div');
            leaf.className = 'leaf';
            leaf.style.left = Math.random() * 100 + '%';
            leaf.style.animationDuration = (Math.random() * 8 + 12) + 's';
            leaf.style.animationDelay = Math.random() * 2 + 's';
            
            const colors = ['#00C851', '#4CAF50', '#7CB342', '#26A69A', '#81C784'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            leaf.style.background = randomColor;
            
            leaves.appendChild(leaf);

            setTimeout(() => {
                if (leaf.parentNode) {
                    leaf.parentNode.removeChild(leaf);
                }
            }, 18000);
        }

        // Sistema di scintille
        function createSparkles() {
            setInterval(() => {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 2 + 's';
                
                document.body.appendChild(sparkle);

                setTimeout(() => {
                    if (sparkle.parentNode) {
                        sparkle.parentNode.removeChild(sparkle);
                    }
                }, 2000);
            }, 3000);
        }

        // Gestione eventi
        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            sendMessage();
        });

        messageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        messageInput.addEventListener('input', adjustTextareaHeight);

        function adjustTextareaHeight() {
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 160) + 'px';
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }

            addMessage('user', message);
            
            messageInput.value = '';
            adjustTextareaHeight();
            
            sendButton.disabled = true;
            
            showTypingIndicator();
            
            sendToAPI(message);
        }

        function addMessage(sender, content) {
            const welcomeMessage = chatMessages.querySelector('.welcome-message');
            if (welcomeMessage) {
                welcomeMessage.style.animation = 'messageSlideIn 0.5s ease-out reverse';
                setTimeout(() => {
                    if (welcomeMessage.parentNode) {
                        welcomeMessage.remove();
                    }
                }, 500);
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString(currentLanguage === 'it' ? 'it-IT' : 'en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const cleanContent = sender === 'ai' ? cleanMarkdownText(content) : content;
            const aiEmoji = sender === 'ai' ? 'ü•ó ' : '';
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    ${aiEmoji}${cleanContent}
                </div>
                <div class="message-time">${timeString}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
            
            conversationHistory.push({
                role: sender === 'user' ? 'user' : 'assistant',
                content: content
            });

            if (sender === 'ai' && 'vibrate' in navigator) {
                navigator.vibrate([50, 100, 50]);
            }
        }

        function showTypingIndicator() {
            typingIndicator.classList.add('show');
            scrollToBottom();
        }

        function hideTypingIndicator() {
            typingIndicator.classList.remove('show');
        }

        function scrollToBottom() {
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }

        async function sendToAPI(userMessage) {
            try {
                const t = texts[currentLanguage];
                
                const messages = [
                    {
                        role: "system",
                        content: t.systemPrompt
                    },
                    ...conversationHistory.slice(-10),
                    {
                        role: "user",
                        content: userMessage
                    }
                ];

                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        'HTTP-Referer': window.location.href,
                        'X-Title': 'Nutrifit AI Chat Interface'
                    },
                    body: JSON.stringify({
                        model: MODEL_NAME,
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: 1000,
                        stream: false
                    })
                });

                if (!response.ok) {
                    throw new Error(`Errore API: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    const aiResponse = data.choices[0].message.content;
                    hideTypingIndicator();
                    addMessage('ai', aiResponse);
                } else {
                    throw new Error('Risposta API non valida');
                }

            } catch (error) {
                console.error('Errore nella chiamata API:', error);
                hideTypingIndicator();
                
                const t = texts[currentLanguage];
                let errorMessage = t.errors.general;
                
                if (error.message.includes('401')) {
                    errorMessage = t.errors.auth;
                } else if (error.message.includes('429')) {
                    errorMessage = t.errors.rate;
                } else if (error.message.includes('500')) {
                    errorMessage = t.errors.server;
                }
                
                addMessage('ai', errorMessage);
            } finally {
                sendButton.disabled = false;
                messageInput.focus();
            }
        }

        // Funzioni utility
        function clearChat() {
            const t = texts[currentLanguage];
            if (confirm(t.clearConfirm)) {
                chatMessages.innerHTML = `
                    <div class="welcome-message">
                        <h2>${t.clearWelcome}</h2>
                        <p>${t.clearText}</p>
                        <div class="nutrition-icons">
                            <span class="nutrition-icon">üçé</span>
                            <span class="nutrition-icon">ü•ï</span>
                            <span class="nutrition-icon">ü•ë</span>
                            <span class="nutrition-icon">üåø</span>
                        </div>
                    </div>
                `;
                conversationHistory = [];
                
                if ('vibrate' in navigator) {
                    navigator.vibrate([100, 50, 100, 50, 100]);
                }
            }
        }

        // Variabile per tracciare il tema corrente
        let isDarkTheme = false;

        function toggleTheme() {
            const root = document.documentElement;
            
            if (!isDarkTheme) {
                // Attiva tema scuro spettacolare
                document.body.style.background = 'linear-gradient(135deg, #1a1a1a 0%, #0d4f3c 25%, #1b5e20 50%, #263238 75%, #1a1a1a 100%)';
                document.body.style.backgroundSize = '400% 400%';
                root.style.setProperty('--text-dark', '#FFFFFF');
                root.style.setProperty('--text-medium', '#E0E0E0');
                root.style.setProperty('--natural-white', 'rgba(255, 255, 255, 0.1)');
                root.style.setProperty('--cream', 'rgba(255, 255, 255, 0.05)');
                root.style.setProperty('--soft-beige', 'rgba(255, 255, 255, 0.08)');
                
                // Aggiorna il container per il tema scuro
                const container = document.querySelector('.container');
                if (container) {
                    container.style.background = 'rgba(0, 0, 0, 0.8)';
                    container.style.backdropFilter = 'blur(30px)';
                    container.style.border = '1px solid rgba(255, 255, 255, 0.1)';
                }
                
                isDarkTheme = true;
                localStorage.setItem('nutrifit_dark_theme', 'true');
            } else {
                // Attiva tema chiaro spettacolare
                document.body.style.background = 'linear-gradient(135deg, #FFF9E6 0%, #F8F6F0 25%, #E8F5E8 50%, #F0F8FF 75%, #FFF9E6 100%)';
                document.body.style.backgroundSize = '400% 400%';
                root.style.setProperty('--text-dark', '#1A1A1A');
                root.style.setProperty('--text-medium', '#4A4A4A');
                root.style.setProperty('--natural-white', '#FFFFFF');
                root.style.setProperty('--cream', '#FFF9E6');
                root.style.setProperty('--soft-beige', '#F8F6F0');
                
                // Ripristina il container per il tema chiaro
                const container = document.querySelector('.container');
                if (container) {
                    container.style.background = 'rgba(255, 255, 255, 0.95)';
                    container.style.backdropFilter = 'blur(30px)';
                    container.style.border = '1px solid rgba(255, 255, 255, 0.3)';
                }
                
                isDarkTheme = false;
                localStorage.setItem('nutrifit_dark_theme', 'false');
            }

            if ('vibrate' in navigator) {
                navigator.vibrate(100);
            }
        }

        // Gestione responsive per mobile
        function handleResize() {
            if (window.innerWidth <= 768) {
                document.body.style.height = '100vh';
                document.body.style.overflow = 'hidden';
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize();

        // Event listeners per i pulsanti floating
        document.addEventListener('DOMContentLoaded', function() {
            // Assicuriamoci che i pulsanti floating funzionino
            const clearButton = document.querySelector('.floating-btn[onclick="clearChat()"]');
            const themeButton = document.querySelector('.floating-btn[onclick="toggleTheme()"]');
            
            if (clearButton) {
                clearButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    clearChat();
                });
            }
            
            if (themeButton) {
                themeButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    toggleTheme();
                });
            }
        });

        // Prevenzione zoom su iOS
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>

